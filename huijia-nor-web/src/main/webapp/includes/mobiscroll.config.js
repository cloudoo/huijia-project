(function($){var A=$.mobiscroll,date=new Date(),defaults={dateFormat:"yyyy-mm-dd",dateOrder:"yymmdd",timeFormat:"HH:ii",timeWheels:"HHii",startYear:date.getFullYear()-100,endYear:date.getFullYear()+1,monthNames:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],monthNamesShort:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],dayNames:["周日","周一;","周二;","周三","周四","周五","周六"],dayNamesShort:["日","一","二","三","四","五","六"],shortYearCutoff:"+10",monthText:"月",dayText:"日",yearText:"年",hourText:"时",minuteText:"分",secText:"秒",ampmText:"&nbsp;",nowText:"Now",showNow:false,stepHour:1,stepMinute:1,stepSecond:1,separator:" "},preset=function(l){var n=$(this),html5def={},format;if(n.is("input")){switch(n.attr("type")){case"date":format="yy-mm-dd";break;case"datetime":format="yy-mm-ddTHH:ii:ssZ";break;case"datetime-local":format="yy-mm-ddTHH:ii:ss";break;case"month":format="yy-mm";html5def.dateOrder="mmyy";break;case"time":format="HH:ii:ss";break}var q=n.attr("min"),max=n.attr("max");if(q){html5def.minDate=A.parseDate(format,q)}if(max){html5def.maxDate=A.parseDate(format,max)}}var s=$.extend({},defaults,html5def,l.settings),offset=0,wheels=[],ord=[],o={},i,k,f={y:"getFullYear",m:"getMonth",d:"getDate",h:getHour,i:getMinute,s:getSecond,a:getAmPm},p=s.preset,dord=s.dateOrder,tord=s.timeWheels,regen=dord.match(/D/),ampm=tord.match(/a/i),hampm=tord.match(/h/),hformat=p=="datetime"?s.dateFormat+s.separator+s.timeFormat:p=="time"?s.timeFormat:s.dateFormat,defd=new Date(),stepH=s.stepHour,stepM=s.stepMinute,stepS=s.stepSecond,mind=s.minDate||new Date(s.startYear,0,1),maxd=s.maxDate||new Date(s.endYear,11,31,23,59,59);l.settings=s;format=format||hformat;if(p.match(/date/i)){$.each(["y","m","d"],function(j,v){i=dord.search(new RegExp(v,"i"));if(i>-1){ord.push({o:i,v:v})}});ord.sort(function(a,b){return a.o>b.o?1:-1});$.each(ord,function(i,v){o[v.v]=i});var w={};for(k=0;k<3;k++){if(k==o.y){offset++;w[s.yearText]={};var r=mind.getFullYear(),end=maxd.getFullYear();for(i=r;i<=end;i++){w[s.yearText][i]=dord.match(/yy/i)?i:(i+"").substr(2,2)}}else{if(k==o.m){offset++;w[s.monthText]={};for(i=0;i<12;i++){var u=dord.replace(/[dy]/gi,"").replace(/mm/,i<9?"0"+(i+1):i+1).replace(/m/,(i+1));w[s.monthText][i]=u.match(/MM/)?u.replace(/MM/,'<span class="dw-mon">'+s.monthNames[i]+"</span>"):u.replace(/M/,'<span class="dw-mon">'+s.monthNamesShort[i]+"</span>")}}else{if(k==o.d){offset++;w[s.dayText]={};for(i=1;i<32;i++){w[s.dayText][i]=dord.match(/dd/i)&&i<10?"0"+i:i}}}}}wheels.push(w)}if(p.match(/time/i)){ord=[];$.each(["h","i","s","a"],function(i,v){i=tord.search(new RegExp(v,"i"));if(i>-1){ord.push({o:i,v:v})}});ord.sort(function(a,b){return a.o>b.o?1:-1});$.each(ord,function(i,v){o[v.v]=offset+i});w={};for(k=offset;k<offset+4;k++){if(k==o.h){offset++;w[s.hourText]={};for(i=0;i<(hampm?12:24);i+=stepH){w[s.hourText][i]=hampm&&i==0?12:tord.match(/hh/i)&&i<10?"0"+i:i}}else{if(k==o.i){offset++;w[s.minuteText]={};for(i=0;i<60;i+=stepM){w[s.minuteText][i]=tord.match(/ii/)&&i<10?"0"+i:i}}else{if(k==o.s){offset++;w[s.secText]={};for(i=0;i<60;i+=stepS){w[s.secText][i]=tord.match(/ss/)&&i<10?"0"+i:i}}else{if(k==o.a){offset++;var z=tord.match(/A/);w[s.ampmText]={0:z?"AM":"am",1:z?"PM":"pm"}}}}}}wheels.push(w)}function get(d,i,a){if(o[i]!==undefined){return+d[o[i]]}if(a!==undefined){return a}return defd[f[i]]?defd[f[i]]():f[i](defd)}function step(v,a){return Math.floor(v/a)*a}function getHour(d){var a=d.getHours();a=hampm&&a>=12?a-12:a;return step(a,stepH)}function getMinute(d){return step(d.getMinutes(),stepM)}function getSecond(d){return step(d.getSeconds(),stepS)}function getAmPm(d){return ampm&&d.getHours()>11?1:0}function getDate(d){var a=get(d,"h",0);return new Date(get(d,"y"),get(d,"m"),get(d,"d",1),get(d,"a")?a+12:a,get(d,"i",0),get(d,"s",0))}l.setDate=function(d,a,b,c){var i;for(i in o){this.temp[o[i]]=d[f[i]]?d[f[i]]():f[i](d)}this.setValue(true,a,b,c)};l.getDate=function(d){return getDate(d)};return{button3Text:s.showNow?s.nowText:undefined,button3:s.showNow?function(){l.setDate(new Date(),false,0.3,true)}:undefined,wheels:wheels,headerText:function(v){return A.formatDate(hformat,getDate(l.temp),s)},formatResult:function(d){return A.formatDate(format,getDate(d),s)},parseValue:function(a){var d=new Date(),i,result=[];try{d=new Date(a)}catch(e){}for(i in o){result[o[i]]=d[f[i]]?d[f[i]]():f[i](d)}return result},validate:function(h,i){var k=l.temp,mins={y:mind.getFullYear(),m:0,d:1,h:0,i:0,s:0,a:0},maxs={y:maxd.getFullYear(),m:11,d:31,h:step(hampm?11:23,stepH),i:step(59,stepM),s:step(59,stepS),a:1},minprop=true,maxprop=true;$.each(["y","m","d","a","h","i","s"],function(x,i){if(o[i]!==undefined){var b=mins[i],max=maxs[i],maxdays=31,val=get(k,i),t=$(".dw-ul",h).eq(o[i]),y,m;if(i=="d"){y=get(k,"y");m=get(k,"m");maxdays=32-new Date(y,m,32).getDate();max=maxdays;if(regen){$(".dw-li",t).each(function(){var a=$(this),d=a.data("val"),w=new Date(y,m,d).getDay(),u=dord.replace(/[my]/gi,"").replace(/dd/,d<10?"0"+d:d).replace(/d/,d);$(".dw-i",a).html(u.match(/DD/)?u.replace(/DD/,'<span class="dw-day">'+s.dayNames[w]+"</span>"):u.replace(/D/,'<span class="dw-day">'+s.dayNamesShort[w]+"</span>"))})}}if(minprop&&mind){b=mind[f[i]]?mind[f[i]]():f[i](mind)}if(maxprop&&maxd){max=maxd[f[i]]?maxd[f[i]]():f[i](maxd)}if(i!="y"){var c=$(".dw-li",t).index($('.dw-li[data-val="'+b+'"]',t)),i2=$(".dw-li",t).index($('.dw-li[data-val="'+max+'"]',t));$(".dw-li",t).removeClass("dw-v").slice(c,i2+1).addClass("dw-v");if(i=="d"){$(".dw-li",t).removeClass("dw-h").slice(maxdays).addClass("dw-h")}}if(val<b){val=b}if(val>max){val=max}if(minprop){minprop=val==b}if(maxprop){maxprop=val==max}if(s.invalid&&i=="d"){var e=[];if(s.invalid.dates){$.each(s.invalid.dates,function(i,v){if(v.getFullYear()==y&&v.getMonth()==m){e.push(v.getDate()-1)}})}if(s.invalid.daysOfWeek){var g=new Date(y,m,1).getDay(),j;$.each(s.invalid.daysOfWeek,function(i,v){for(j=v-g;j<maxdays;j+=7){if(j>=0){e.push(j)}}})}if(s.invalid.daysOfMonth){$.each(s.invalid.daysOfMonth,function(i,v){v=(v+"").split("/");if(v[1]){if(v[0]-1==m){e.push(v[1]-1)}}else{e.push(v[0]-1)}})}$.each(e,function(i,v){$(".dw-li",t).eq(v).removeClass("dw-v")})}k[o[i]]=val}})},methods:{getDate:function(a){var b=$(this).mobiscroll("getInst");if(b){return b.getDate(a?b.temp:b.values)}},setDate:function(d,b,c,e){if(b==undefined){b=false}return this.each(function(){var a=$(this).mobiscroll("getInst");if(a){a.setDate(d,b,c,e)}})}}}};$.each(["date","time","datetime"],function(i,v){A.presets[v]=preset;A.presetShort(v)});A.formatDate=function(c,d,e){if(!d){return null}var s=$.extend({},defaults,e),look=function(m){var n=0;while(i+1<c.length&&c.charAt(i+1)==m){n++;i++}return n},f1=function(m,a,b){var n=""+a;if(look(m)){while(n.length<b){n="0"+n}}return n},f2=function(m,a,s,l){return(look(m)?l[a]:s[a])},i,output="",literal=false;for(i=0;i<c.length;i++){if(literal){if(c.charAt(i)=="'"&&!look("'")){literal=false}else{output+=c.charAt(i)}}else{switch(c.charAt(i)){case"d":output+=f1("d",d.getDate(),2);break;case"D":output+=f2("D",d.getDay(),s.dayNamesShort,s.dayNames);break;case"o":output+=f1("o",(d.getTime()-new Date(d.getFullYear(),0,0).getTime())/86400000,3);break;case"m":output+=f1("m",d.getMonth()+1,2);break;case"M":output+=f2("M",d.getMonth(),s.monthNamesShort,s.monthNames);break;case"y":output+=(look("y")?d.getFullYear():(d.getYear()%100<10?"0":"")+d.getYear()%100);break;case"h":var h=d.getHours();output+=f1("h",(h>12?(h-12):(h==0?12:h)),2);break;case"H":output+=f1("H",d.getHours(),2);break;case"i":output+=f1("i",d.getMinutes(),2);break;case"s":output+=f1("s",d.getSeconds(),2);break;case"a":output+=d.getHours()>11?"pm":"am";break;case"A":output+=d.getHours()>11?"PM":"AM";break;case"'":if(look("'")){output+="'"}else{literal=true}break;default:output+=c.charAt(i)}}}return output};A.parseDate=function(c,d,e){var f=new Date();if(!c||!d){return f}d=(typeof d=="object"?d.toString():d+"");var s=$.extend({},defaults,e),shortYearCutoff=s.shortYearCutoff,year=f.getFullYear(),month=f.getMonth()+1,day=f.getDate(),doy=-1,hours=f.getHours(),minutes=f.getMinutes(),seconds=0,ampm=-1,literal=false,lookAhead=function(a){var b=(iFormat+1<c.length&&c.charAt(iFormat+1)==a);if(b){iFormat++}return b},getNumber=function(a){lookAhead(a);var b=(a=="@"?14:(a=="!"?20:(a=="y"?4:(a=="o"?3:2)))),digits=new RegExp("^\\d{1,"+b+"}"),num=d.substr(iValue).match(digits);if(!num){return 0}iValue+=num[0].length;return parseInt(num[0],10)},getName=function(a,s,l){var b=(lookAhead(a)?l:s),i;for(i=0;i<b.length;i++){if(d.substr(iValue,b[i].length).toLowerCase()==b[i].toLowerCase()){iValue+=b[i].length;return i+1}}return 0},checkLiteral=function(){iValue++},iValue=0,iFormat;for(iFormat=0;iFormat<c.length;iFormat++){if(literal){if(c.charAt(iFormat)=="'"&&!lookAhead("'")){literal=false}else{checkLiteral()}}else{switch(c.charAt(iFormat)){case"d":day=getNumber("d");break;case"D":getName("D",s.dayNamesShort,s.dayNames);break;case"o":doy=getNumber("o");break;case"m":month=getNumber("m");break;case"M":month=getName("M",s.monthNamesShort,s.monthNames);break;case"y":year=getNumber("y");break;case"H":hours=getNumber("H");break;case"h":hours=getNumber("h");break;case"i":minutes=getNumber("i");break;case"s":seconds=getNumber("s");break;case"a":ampm=getName("a",["am","pm"],["am","pm"])-1;break;case"A":ampm=getName("A",["am","pm"],["am","pm"])-1;break;case"'":if(lookAhead("'")){checkLiteral()}else{literal=true}break;default:checkLiteral()}}}if(year<100){year+=new Date().getFullYear()-new Date().getFullYear()%100+(year<=(typeof shortYearCutoff!="string"?shortYearCutoff:new Date().getFullYear()%100+parseInt(shortYearCutoff,10))?0:-100)}if(doy>-1){month=1;day=doy;do{var g=32-new Date(year,month-1,32).getDate();if(day<=g){break}month++;day-=g}while(true)}hours=(ampm==-1)?hours:((ampm&&hours<12)?(hours+12):(!ampm&&hours==12?0:hours));var h=new Date(year,month-1,day,hours,minutes,seconds);if(h.getFullYear()!=year||h.getMonth()+1!=month||h.getDate()!=day){throw"Invalid date"}return h}})(jQuery);